---
import Layout from '../layouts/Layout.astro';
import HeadsetCard from '../components/HeadsetCard.astro';
import FeatureSelector from '../components/FeatureSelector.astro';
import { getCollection } from 'astro:content';

const headsets = await getCollection('headsets');
const headsetData = headsets.map(headset => ({
  ...headset.data,
  slug: headset.slug,
}));

// Get unique brands for filter
const brands = [...new Set(headsetData.map(h => h.brand))];
const maxPrice = Math.max(...headsetData.map(h => h.price));
const maxWeight = Math.max(...headsetData.map(h => h.weight));
---

<Layout>
  <div class="min-h-screen bg-dark-bg">
    <header class="bg-dark-surface border-b border-dark-border shadow-sm">
           <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold text-dark-text-primary">Gaming Headset Comparison</h1>
            <p class="text-dark-text-secondary mt-1">Find the perfect gaming headset by filtering objective specs</p>
          </div>
          <div class="flex gap-2">
            <button id="export-favorites" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm">
              Export Favorites
            </button>
            <button id="import-favorites" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm">
              Import Favorites
            </button>
            <input type="file" id="import-file" accept=".json" class="hidden">
          </div>
        </div>
      </div>
    </header>

      <main class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <FeatureSelector brands={brands} initialCount={headsetData.length} />

      <div id="headsets-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {headsetData.map(headset => (
          <HeadsetCard headset={headset} />
        ))}
      </div>

      {headsetData.length === 0 && (
        <div class="text-center py-12">
          <p class="text-dark-text-muted">No headsets found matching your criteria.</p>
        </div>
      )}
    </main>
  </div>

   <script src="/scripts/filtering.js" is:inline></script>
     <script define:vars={{headsetData}}>
       // Pass headset data to client-side script
       console.log('Setting window.headsetData in define:vars');
       window.headsetData = {headsetData};
     </script>
</Layout>