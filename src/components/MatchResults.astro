---
import { getPriceTier, getPriceTierConfig } from '../lib/pricing.js';

interface Props {
  headset: any;
  matchResult?: any;
}

const { headset, matchResult } = Astro.props;
const priceTier = getPriceTier(headset.price);
const tierConfig = getPriceTierConfig(priceTier);

// Get match type styling
function getMatchTypeStyling(matchType: string) {
  switch (matchType) {
    case 'complete':
      return { bg: 'bg-green-900/40', text: 'text-green-300', border: 'border-green-700/50', label: 'Complete Match' };
    case 'majority':
      return { bg: 'bg-blue-900/40', text: 'text-blue-300', border: 'border-blue-700/50', label: 'Majority Match' };
    case 'partial':
      return { bg: 'bg-yellow-900/40', text: 'text-yellow-300', border: 'border-yellow-700/50', label: 'Partial Match' };
    default:
      return { bg: 'bg-gray-700/40', text: 'text-gray-300', border: 'border-gray-600/50', label: 'No Match' };
  }
}

const matchStyling = matchResult ? getMatchTypeStyling(matchResult.matchType) : null;
---

<div class="bg-dark-card rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 p-6 border border-dark-border">
  <div class="flex flex-col sm:flex-row gap-4">
    <div class="w-full sm:w-48 h-48 bg-dark-surface rounded-lg overflow-hidden flex-shrink-0">
      <img 
        src={headset.image} 
        alt={`${headset.brand} ${headset.name} gaming headset`}
        class="w-full h-full object-cover"
        loading="lazy"
      />
    </div>
    
    <div class="flex-1">
      <div class="flex justify-between items-start mb-2">
        <div>
          <h3 class="text-xl font-semibold text-dark-text-primary">{headset.name}</h3>
          <p class="text-sm text-dark-text-secondary">{headset.brand}</p>
        </div>
        <div class="text-right">
          <p class="text-2xl font-bold text-green-400">${headset.price}</p>
          <span class={`inline-block px-2 py-1 text-xs rounded-full font-medium ${tierConfig.color === 'green' ? 'bg-green-900/40 text-green-300' : tierConfig.color === 'blue' ? 'bg-blue-900/40 text-blue-300' : tierConfig.color === 'purple' ? 'bg-purple-900/40 text-purple-300' : 'bg-yellow-900/40 text-yellow-300'}`}>
            {tierConfig.label}
          </span>
        </div>
      </div>

      {/* Match Badge */}
      {matchStyling && (
        <div class={`mb-3 px-3 py-1 rounded-full text-sm font-medium border ${matchStyling.bg} ${matchStyling.text} ${matchStyling.border}`}>
          {matchStyling.label} 
          {matchResult.score > 0 && (
            <span class="ml-2 font-bold">Score: {matchResult.score}</span>
          )}
        </div>
      )}

      {/* Feature Tags */}
      <div class="flex flex-wrap gap-2 mb-4">
        {headset.wireless && (
          <span class="px-2 py-1 bg-blue-900/40 text-blue-300 text-xs rounded-full border border-blue-700/50">Wireless</span>
        )}
        {headset.battery && (
          <span class="px-2 py-1 bg-green-900/40 text-green-300 text-xs rounded-full border border-green-700/50">{headset.battery}h Battery</span>
        )}
        <span class="px-2 py-1 bg-gray-700/40 text-gray-300 text-xs rounded-full border border-gray-600/50">{headset.weight}g</span>
        <span class="px-2 py-1 bg-purple-900/40 text-purple-300 text-xs rounded-full border border-purple-700/50">{headset.microphone_type.replace('_', ' ')}</span>
        {headset.rgb_lighting !== 'none' && (
          <span class="px-2 py-1 bg-pink-900/40 text-pink-300 text-xs rounded-full border border-pink-700/50">RGB Lighting</span>
        )}
        {headset.noise_cancellation !== 'none' && (
          <span class="px-2 py-1 bg-indigo-900/40 text-indigo-300 text-xs rounded-full border border-indigo-700/50">Noise Cancelling</span>
        )}
      </div>
      
      <div class="text-sm text-dark-text-secondary mb-4">
        <p class="mb-1"><strong class="text-dark-text-primary">Compatibility:</strong> {headset.compatibility.join(', ')}</p>
      </div>
      
      <div class="flex gap-2">
        <a 
          href={`/headsets/${headset.id}`}
          class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
        >
          View Details
        </a>
        <button 
          class="favorite-button p-2 border border-dark-border rounded-md hover:bg-dark-surface transition-colors"
          data-headset-id={headset.id}
        >
          <svg class="w-5 h-5 text-dark-text-muted favorite-icon hover:text-red-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>