---
import { X } from "@lucide/astro";

interface Props {
  isOpen?: boolean;
}

const { isOpen = false } = Astro.props;
---

<div id="mobile-menu" class={`mobile-menu ${isOpen ? "open" : ""}`}>
  <div
    class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-end"
  >
    <button
      id="close-menu"
      aria-label="Close menu"
      class="text-white hover:text-primary transition-colors"
    >
      <X class="w-6 h-6" />
    </button>
  </div>

  <nav
    class="flex flex-col items-center justify-center h-[calc(100%-4rem)] space-y-8"
  >
    <a
      href="/"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Home
    </a>
    <a
      href="/find-headsets"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Find Your Headset
    </a>
    <a
      href="/blog"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Blog
    </a>
    <a
      href="/find-headsets"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Search
    </a>
    <a
      href="/favorites"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Favorites
    </a>
  </nav>

  <script>
    let cleanup: (() => void) | null = null;

    document.addEventListener("astro:page-load", () => {
      if (cleanup) cleanup();

      const closeMenuBtn = document.getElementById("close-menu");
      const mobileMenu = document.getElementById("mobile-menu");
      const mobileLinks = document.querySelectorAll("[data-mobile-link]");

      function closeMenu() {
        mobileMenu?.classList.remove("open");
        document.body.style.overflow = "";
      }

      const onEscape = (e: KeyboardEvent) => {
        if (e.key === "Escape") closeMenu();
      };

      const onOutsideClick = (e: MouseEvent) => {
        if (e.target === mobileMenu) closeMenu();
      };

      closeMenuBtn?.addEventListener("click", closeMenu);
      mobileLinks.forEach((link) => link.addEventListener("click", closeMenu));

      document.addEventListener("keydown", onEscape);
      mobileMenu?.addEventListener("click", onOutsideClick);

      cleanup = () => {
        document.removeEventListener("keydown", onEscape);
      };
    });
  </script>
</div>

<style>
  .mobile-menu {
    position: fixed;
    inset: 0;
    z-index: 50;
    background: rgba(0, 0, 0, 0.98);
    backdrop-filter: blur(12px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-out;
  }

  .mobile-menu.open {
    opacity: 1;
    pointer-events: auto;
  }

  @media (min-width: 1024px) {
    .mobile-menu {
      display: none;
    }
  }
</style>
