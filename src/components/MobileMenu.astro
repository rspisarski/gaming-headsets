---
import { X } from "@lucide/astro";

interface Props {
  isOpen?: boolean;
}

const { isOpen = false } = Astro.props;
---

<div id="mobile-menu" class={`mobile-menu ${isOpen ? "open" : ""}`}>
  <nav class="flex flex-col items-center justify-center h-full space-y-8">
    <a
      href="/"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Home
    </a>
    <a
      href="/headsets"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Headsets
    </a>
    <a
      href="/blog"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Blog
    </a>
    <button
      id="mobile-search-button"
      class="text-3xl text-white hover:text-primary transition-colors font-bold bg-transparent border-none cursor-pointer"
      data-mobile-link
    >
      Search
    </button>
    <a
      href="/favorites"
      class="text-3xl text-white hover:text-primary transition-colors font-bold"
      data-mobile-link
    >
      Favorites
    </a>
  </nav>

  <script>
    let cleanup: (() => void) | null = null;

    document.addEventListener("astro:page-load", () => {
      if (cleanup) cleanup();

      const mobileMenu = document.getElementById("mobile-menu");
      const mobileLinks = document.querySelectorAll("[data-mobile-link]");
      const mobileSearchBtn = document.getElementById("mobile-search-button");

      function closeMenu() {
        mobileMenu?.classList.remove("open");
        document.body.style.overflow = "";
        // Dispatch custom event to notify Layout to sync icons
        document.dispatchEvent(new CustomEvent("menu-closed"));
      }

      function openSearch() {
        closeMenu();
        setTimeout(() => {
          document.getElementById("nav-search-button")?.click();
        }, 300);
      }

      const onEscape = (e: KeyboardEvent) => {
        if (e.key === "Escape") closeMenu();
      };

      const onOutsideClick = (e: MouseEvent) => {
        if (e.target === mobileMenu) closeMenu();
      };

      mobileLinks.forEach((link) => link.addEventListener("click", closeMenu));
      mobileSearchBtn?.addEventListener("click", openSearch);

      document.addEventListener("keydown", onEscape);
      mobileMenu?.addEventListener("click", onOutsideClick);

      cleanup = () => {
        document.removeEventListener("keydown", onEscape);
      };
    });
  </script>
</div>

<style>
  .mobile-menu {
    position: fixed;
    inset: 0;
    z-index: 50;
    background: rgba(0, 0, 0, 0.98);
    backdrop-filter: blur(12px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-out;
  }

  .mobile-menu.open {
    opacity: 1;
    pointer-events: auto;
  }

  @media (min-width: 1024px) {
    .mobile-menu {
      display: none;
    }
  }
</style>
